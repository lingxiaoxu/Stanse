# Production Mode (Demo OFF) - çœŸå®åŠŸèƒ½å’Œæ•°æ®è¯´æ˜

## å½“å‰çŠ¶æ€ (2025-11-27)

**åç«¯è¿è¡Œä¸­**: `USE_DEMO_DATA=false` (Production Mode)
**ç«¯å£**: 8080
**å½“å‰æ•°æ®**: ç©ºï¼ˆå…¨éƒ¨ä»é›¶å¼€å§‹ï¼‰

```json
{
  "active_allies_online": 0,      // åœ¨çº¿ç”¨æˆ·: 0
  "total_union_strength": 0,       // è”ç›Ÿå¼ºåº¦: 0
  "capital_diverted_usd": 0.0,    // è½¬ç§»èµ„æœ¬: $0
  "total_shards": 0,               // åˆ†ç‰‡æ•°: 0
  "total_active_campaigns": 0      // æ´»åŠ¨æˆ˜å½¹: 0
}
```

---

## ğŸ”’ Production Mode å®Œæ•´åŠŸèƒ½åˆ—è¡¨

### âœ… å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡çš„åŠŸèƒ½

#### 1. **ç”¨æˆ·æ³¨å†Œ (Firebase â†’ Polis DID)**
**API**: `POST /api/v1/users/register`

**çœŸå®æ•°æ®æ¥æº**: Firebase Authentication
- ç”¨æˆ·é€šè¿‡å‰ç«¯ Firebase ç™»å½•
- å®Œæˆæ”¿æ²»ç«‹åœºé—®å·ï¼ˆeconomic, social, diplomaticåæ ‡ï¼‰
- è‡ªåŠ¨æ³¨å†Œåˆ° Polis Protocol
- ç”Ÿæˆå”¯ä¸€ Polis DID: `did:polis:firebase:{firebase_uid}`

**ç¤ºä¾‹**:
```json
è¯·æ±‚:
{
  "firebase_uid": "abc123xyz",
  "display_name": "å¼ ä¸‰",
  "economic": -45.5,
  "social": 60.0,
  "diplomatic": 20.5
}

å“åº”:
{
  "success": true,
  "data": "did:polis:firebase:abc123xyz",
  "error": null
}
```

**å­˜å‚¨çš„çœŸå®æ•°æ®**:
```rust
FirebaseUserInfo {
    firebase_uid: "abc123xyz",
    polis_did: "did:polis:firebase:abc123xyz",
    display_name: "å¼ ä¸‰",
    coordinates: (-45.5, 60.0, 20.5),  // çœŸå®çš„æ”¿æ²»ç«‹åœºåæ ‡
    is_online: true,
    last_activity: 1732684800,  // Unixæ—¶é—´æˆ³
    total_actions: 0
}
```

---

#### 2. **å¿ƒè·³ç›‘æ§ (å®æ—¶åœ¨çº¿çŠ¶æ€)**
**API**: `POST /api/v1/users/heartbeat`

**çœŸå®æ•°æ®æ¥æº**: å‰ç«¯è‡ªåŠ¨å‘é€
- æ¯30ç§’è‡ªåŠ¨å‘é€å¿ƒè·³
- ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾é¡µ â†’ å‘é€ `is_online: false`
- ç”¨æˆ·å›åˆ°é¡µé¢ â†’ å‘é€ `is_online: true`
- ç”¨æˆ·å…³é—­é¡µé¢ â†’ Beacon API å‘é€æœ€åç¦»çº¿çŠ¶æ€

**ç¤ºä¾‹**:
```json
{
  "firebase_uid": "abc123xyz",
  "is_online": true
}
```

**æ›´æ–°çš„çœŸå®æ•°æ®**:
- `is_online` çŠ¶æ€å®æ—¶æ›´æ–°
- `last_activity` æ—¶é—´æˆ³å®æ—¶æ›´æ–°
- ç»Ÿè®¡ä¸­çš„ `active_allies_online` ä¼šå®æ—¶å˜åŒ–

---

#### 3. **ç”¨æˆ·è¡ŒåŠ¨è®°å½• (Buycott/Boycott)**
**API**: `POST /api/v1/actions/record`

**çœŸå®æ•°æ®æ¥æº**: ç”¨æˆ·åœ¨å‰ç«¯çš„çœŸå®äº¤äº’
- ç”¨æˆ·æŸ¥çœ‹ **Company Ranking** (å…¬å¸æ’å)
- ç‚¹å‡» Support åˆ—çš„å…¬å¸ â†’ è®°å½• `Buycott` (æ”¯æŒè¡ŒåŠ¨)
- ç‚¹å‡» Oppose åˆ—çš„å…¬å¸ â†’ è®°å½• `Boycott` (æŠµåˆ¶è¡ŒåŠ¨)
- æ¯æ¬¡ç‚¹å‡»ä¼°å€¼ $50 (5000ç¾åˆ†)

**ç¤ºä¾‹**:
```json
{
  "firebase_uid": "abc123xyz",
  "action_type": "Buycott",
  "target": "AAPL",
  "value_cents": 5000
}
```

**è®°å½•çš„çœŸå®æ•°æ®**:
```rust
ImpactAction {
    user_did: "did:polis:firebase:abc123xyz",
    action_type: Buycott,
    target_entity: "AAPL",
    value_diverted: 5000,  // $50
    zk_proof: "firebase_verified_...",
    timestamp: 1732684800,
    action_id: "unique-uuid"
}
```

**å½±å“çš„ç»Ÿè®¡æ•°æ®**:
- `total_actions` +1
- `capital_diverted_usd` +$50
- ç”¨æˆ·ä¸ªäººçš„ `total_diverted` ç´¯åŠ 

---

#### 4. **å…¨å±€ç»Ÿè®¡ (å®æ—¶èšåˆ)**
**API**: `GET /api/v1/stats/global`

**çœŸå®æ•°æ®è®¡ç®—**:
- `active_allies_online`: å½“å‰åœ¨çº¿çš„çœŸå®Firebaseç”¨æˆ·æ•°
- `total_union_strength`: æ‰€æœ‰çœŸå®ç”¨æˆ·çš„è”ç›Ÿå¼ºåº¦æ€»å’Œ
- `capital_diverted_usd`: æ‰€æœ‰çœŸå®ç”¨æˆ·è¡ŒåŠ¨çš„é‡‘é¢æ€»å’Œ
- `total_shards`: æ ¹æ®ç”¨æˆ·ç«‹åœºè‡ªåŠ¨åˆ›å»ºçš„åˆ†ç‰‡æ•°
- `total_active_campaigns`: ç”¨æˆ·åˆ›å»ºçš„çœŸå®æˆ˜å½¹æ•°

**å½“å‰å€¼**: å…¨éƒ¨ä¸º 0ï¼ˆå› ä¸ºè¿˜æ²¡æœ‰çœŸå®ç”¨æˆ·ç™»å½•ï¼‰

---

#### 5. **æˆ˜å½¹åˆ—è¡¨ (ç”¨æˆ·åˆ›å»ºçš„æˆ˜å½¹)**
**API**: `GET /api/v1/campaigns`

**çœŸå®æ•°æ®æ¥æº**: ç”¨æˆ·åˆ›å»ºçš„æˆ˜å½¹
- å½“å‰: ç©ºæ•°ç»„ `[]`
- å°†æ¥: ç”¨æˆ·å¯ä»¥åˆ›å»ºæˆ˜å½¹ï¼ˆéœ€è¦å‰ç«¯UIå®ç°ï¼‰

---

## ğŸ“Š çœŸå®æ•°æ®æµ

### å®Œæ•´ç”¨æˆ·æµç¨‹ï¼š

```
1. ç”¨æˆ·åœ¨å‰ç«¯ç™»å½• (Firebase)
   â†“
2. å®Œæˆæ”¿æ²»ç«‹åœºé—®å·
   â†“
3. å‰ç«¯è°ƒç”¨ registerUser()
   â†’ Backend åˆ›å»º FirebaseUserInfo
   â†’ åˆ†é… Polis DID
   â†’ è·¯ç”±åˆ°åŒ¹é…çš„ Shard
   â†“
4. å‰ç«¯å¯åŠ¨ Heartbeat (æ¯30ç§’)
   â†’ Backend æ›´æ–° is_online, last_activity
   â†’ ç»Ÿè®¡ä¸­çš„ active_allies_online å®æ—¶å¢åŠ 
   â†“
5. ç”¨æˆ·æŸ¥çœ‹å…¬å¸æ’åï¼Œç‚¹å‡»å…¬å¸
   â†’ recordUserAction() è°ƒç”¨
   â†’ Backend è®°å½• ImpactAction
   â†’ total_actions +1
   â†’ capital_diverted_usd +$50
   â†“
6. ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾é¡µ
   â†’ Heartbeat å‘é€ is_online: false
   â†’ active_allies_online -1
   â†“
7. ç”¨æˆ·å›åˆ°é¡µé¢
   â†’ Heartbeat å‘é€ is_online: true
   â†’ active_allies_online +1
   â†“
8. ç”¨æˆ·ç™»å‡ºæˆ–å…³é—­é¡µé¢
   â†’ Beacon API å‘é€æœ€åç¦»çº¿çŠ¶æ€
   â†’ stopHeartbeat()
   â†’ is_online = false
```

---

## ğŸ¯ çœŸå®æ•°æ®ç¤ºä¾‹

### å‡è®¾æœ‰3ä¸ªçœŸå®ç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿï¼š

**ç”¨æˆ·A**:
- Firebase UID: `user_alice_123`
- ç«‹åœº: ç»æµå·¦ç¿¼(-60), ç¤¾ä¼šè‡ªç”±(70), å¤–äº¤é¸½æ´¾(40)
- è¡ŒåŠ¨: æ”¯æŒäº† TSLA, NVDA (2æ¬¡ç‚¹å‡»)
- è´¡çŒ®èµ„æœ¬: $100

**ç”¨æˆ·B**:
- Firebase UID: `user_bob_456`
- ç«‹åœº: ç»æµå³ç¿¼(50), ç¤¾ä¼šä¿å®ˆ(-30), å¤–äº¤é¹°æ´¾(-50)
- è¡ŒåŠ¨: æŠµåˆ¶äº† AAPL, GOOGL (2æ¬¡ç‚¹å‡»)
- è´¡çŒ®èµ„æœ¬: $100

**ç”¨æˆ·C**:
- Firebase UID: `user_carol_789`
- ç«‹åœº: ç»æµä¸­ç«‹(0), ç¤¾ä¼šä¸­ç«‹(0), å¤–äº¤ä¸­ç«‹(0)
- è¡ŒåŠ¨: æ”¯æŒäº† MSFT (1æ¬¡ç‚¹å‡»)
- è´¡çŒ®èµ„æœ¬: $50

### å…¨å±€ç»Ÿè®¡ä¼šæ˜¾ç¤ºï¼š

```json
{
  "active_allies_online": 3,           // 3ä¸ªåœ¨çº¿ç”¨æˆ·
  "total_union_strength": 15,          // æ ¹æ®è¡ŒåŠ¨è®¡ç®—
  "capital_diverted_usd": 250.0,       // $100+$100+$50
  "total_shards": 2,                   // æ ¹æ®ç«‹åœºè‡ªåŠ¨åˆ›å»º2ä¸ªåˆ†ç‰‡
  "total_active_campaigns": 0          // è¿˜æ²¡æœ‰æˆ˜å½¹
}
```

---

## ğŸ”‘ å…³é”®åŒºåˆ«ï¼šDemo vs Production

| æ•°æ®é¡¹ | Demo Mode | Production Mode |
|--------|-----------|-----------------|
| **ç”¨æˆ·æ¥æº** | é¢„è®¾çš„13ä¸ªå‡ç”¨æˆ· | çœŸå®Firebaseç™»å½•ç”¨æˆ· |
| **ç”¨æˆ·å** | "Alice Test", "Bob Demo" | Firebase displayName |
| **ç«‹åœºåæ ‡** | éšæœºç”Ÿæˆ | ç”¨æˆ·é—®å·è®¡ç®— |
| **åœ¨çº¿çŠ¶æ€** | é¢„è®¾ä¸ºåœ¨çº¿ | çœŸå®å¿ƒè·³è¿½è¸ª |
| **è¡ŒåŠ¨æ•°æ®** | é¢„è®¾çš„å‡è¡ŒåŠ¨ | ç”¨æˆ·çœŸå®ç‚¹å‡» |
| **èµ„æœ¬é‡‘é¢** | é¢„è®¾$750 | ç´¯åŠ çœŸå®ç‚¹å‡» ($50/æ¬¡) |
| **åˆ†ç‰‡** | é¢„åˆ›å»º3ä¸ª | æŒ‰éœ€åŠ¨æ€åˆ›å»º |
| **æˆ˜å½¹** | é¢„è®¾3ä¸ªå‡æˆ˜å½¹ | ç”¨æˆ·åˆ›å»ºï¼ˆæš‚æ— ï¼‰ |
| **æŒä¹…åŒ–** | å†…å­˜ï¼ˆé‡å¯ä¸¢å¤±ï¼‰ | å†…å­˜ï¼ˆé‡å¯ä¸¢å¤±ï¼‰ |

---

## âš ï¸ å½“å‰é™åˆ¶

### 1. **æ•°æ®æŒä¹…åŒ–**
- **å½“å‰**: æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ (`HashMap`)
- **åæœ**: åç«¯é‡å¯åæ‰€æœ‰ç”¨æˆ·æ•°æ®ä¸¢å¤±
- **æœªæ¥**: éœ€è¦æ¥å…¥æ•°æ®åº“ (PostgreSQL/MongoDB)

### 2. **Shard è‡ªåŠ¨åˆ›å»º**
- **å½“å‰**: Production Mode å¯åŠ¨æ—¶ shards = 0
- **é—®é¢˜**: ç”¨æˆ·æ³¨å†Œæ—¶ä¼šå°è¯•è·¯ç”±åˆ° shardï¼Œä½†æ²¡æœ‰é¢„åˆ›å»ºçš„ shard
- **éœ€è¦**: åˆå§‹åŒ–æ—¶åˆ›å»ºä¸€äº›åŸºç¡€ shardsï¼Œæˆ–è€…åœ¨é¦–æ¬¡ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»º

### 3. **æˆ˜å½¹åˆ›å»ºUI**
- **å½“å‰**: åªèƒ½è®°å½•è¡ŒåŠ¨ï¼Œæ— æ³•åˆ›å»ºæˆ˜å½¹
- **éœ€è¦**: å‰ç«¯æ·»åŠ "åˆ›å»ºæˆ˜å½¹"åŠŸèƒ½

---

## ğŸš€ å¦‚ä½•éªŒè¯çœŸå®åŠŸèƒ½

### æµ‹è¯•æ­¥éª¤ï¼š

1. **å¯åŠ¨åç«¯** (Production Mode):
```bash
cd backend/polis-protocol
USE_DEMO_DATA=false cargo run --release
```

2. **å¯åŠ¨å‰ç«¯**:
```bash
npm run dev
```

3. **çœŸå®ç”¨æˆ·æµç¨‹**:
```
a. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:5173
b. ä½¿ç”¨ Firebase ç™»å½•ï¼ˆGoogleè´¦å·ï¼‰
c. å®Œæˆæ”¿æ²»ç«‹åœºé—®å·
d. æŸ¥çœ‹ Company Ranking
e. ç‚¹å‡»å‡ å®¶å…¬å¸ï¼ˆSupportæˆ–Opposeï¼‰
```

4. **æŸ¥çœ‹åç«¯æ•°æ®**:
```bash
# æŸ¥çœ‹å…¨å±€ç»Ÿè®¡
curl http://localhost:8080/api/v1/stats/global | jq

# åº”è¯¥çœ‹åˆ°:
# active_allies_online: 1 (ä½ è‡ªå·±)
# capital_diverted_usd: 50.0 æˆ– 100.0 (å–å†³äºç‚¹å‡»æ¬¡æ•°)
```

5. **æŸ¥çœ‹åç«¯æ—¥å¿—**:
```bash
# åº”è¯¥çœ‹åˆ°:
âœ… User registered with Polis DID: did:polis:firebase:your_uid
ğŸ’“ Heartbeat received every 30 seconds
ğŸ“Š Action recorded: Buycott on AAPL
```

---

## âœ… ç¡®è®¤ï¼šProduction Mode çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯çœŸå®çš„

**âœ“ ç”¨æˆ·æ•°æ®**: æ¥è‡ªçœŸå®çš„ Firebase Authentication
**âœ“ ç«‹åœºåæ ‡**: æ¥è‡ªç”¨æˆ·å¡«å†™çš„çœŸå®é—®å·
**âœ“ åœ¨çº¿çŠ¶æ€**: é€šè¿‡çœŸå®çš„å¿ƒè·³ç›‘æ§
**âœ“ è¡ŒåŠ¨è®°å½•**: ç”¨æˆ·åœ¨UIä¸Šçš„çœŸå®ç‚¹å‡»
**âœ“ ç»Ÿè®¡æ•°æ®**: å®æ—¶èšåˆçœŸå®ç”¨æˆ·çš„æ•°æ®

**âœ— æ²¡æœ‰ä»»ä½•æ¨¡æ‹Ÿæ•°æ®**
**âœ— æ²¡æœ‰ä»»ä½•å‡ç”¨æˆ·**
**âœ— æ²¡æœ‰ä»»ä½•é¢„è®¾è¡ŒåŠ¨**

---

## ğŸ“ æ€»ç»“

**Production Mode = 100% çœŸå®ç”¨æˆ·æ•°æ®**

- æ‰€æœ‰æ•°æ®ä»é›¶å¼€å§‹
- åªæœ‰çœŸå®ç”¨æˆ·ç™»å½•åæ‰ä¼šæœ‰æ•°æ®
- æ‰€æœ‰ç»Ÿè®¡æ•°å­—éƒ½æ˜¯å®æ—¶è®¡ç®—çš„çœŸå®å€¼
- æ²¡æœ‰ä»»ä½•demo/æµ‹è¯•æ•°æ®æ··å…¥

**å½“å‰çŠ¶æ€**: ç³»ç»Ÿå·²å‡†å¤‡å¥½æ¥æ”¶çœŸå®ç”¨æˆ·ï¼Œç­‰å¾…ç¬¬ä¸€ä¸ªç”¨æˆ·ç™»å½•ï¼
